# 根注册器
&emsp;&emsp;一个智能合约，可以管理顶级域名和顶级域名注册器的对应关系
## 管理顶级域名的实现
&emsp;&emsp;使用合约私有存储区保存顶级域名namehash和顶级域名注册器的scripthash的对应关系，namehash为key，scripthash为value
## 根注册器的治理
&emsp;&emsp;根注册器的修改操作需要若干奇数根登记员（地址或合约）进行签名，签名超过三分之二方可执行。根注册器的操作应该是非常谨慎的，仅为按需增加新顶级域名与修复已有顶级域名注册器重大bug而操作。
# 顶级域名注册器
&emsp;&emsp;定义了一个顶级域名的注册规范，不同顶级域名可能又不同规范，目前我们已经设定如下顶级域名与规则：
- .test
    - 该顶级域名及其下域名树仅为测试目的设立
    - 域名树的根为.test
    - 任何人可以注册为未被注册或已过期的以.test结尾的主域名
    - 每个被注册的域名有效期为30天，有效期到期时原登记员不具有优先续期权
    - 主域名长度最小不得小于1个字符。为兼容传统DNS，最大长度不能超过63个字符
    - 主域名登记员拥有分配、管理子域名、移交子域名管理权的权限，子域名应该最多含有两级（以.分割），总长度不能超过253个字符
    - 主域名登记员可以主动移交所有权，但是有效期不重新计算
    - 主域名登记员可以主动撤销一个其所有主域名的所有权
- .neo
    - 该顶级域名及其下域名树为正式使用目的设立，可以用于生产
    - 域名树的根为.neo
    - 主域名的所有权通过竞标获得，任何人可以为未被注册或已过期的以.test结尾的主域名开标。
    - 每个被注册的域名有效期为365天，有效期到期前30天内原登记员可以优先获得所有权续期权，续期将需要支付租金（租金确定模型将稍后公布）
    - 主域名的长度在不同阶段设置有不同限制
        - 第一阶段，.neo发布后，主域名长度最小不得小于7个字符，最大不得大于63个字符
        - 第二阶段，上一阶段后180天，主域名长度最小不得小于3个字符，最大不得大于63个字符
        - 第三阶段，上一阶段后180天，主域名长度最小不得小于2个字符，最大不得大于63个字符
        - 第四阶段，上一阶段后180天，主域名长度最小不得小于1个字符，最大不得大于63个字符
    - 主域名登记员拥有分配、管理子域名、移交子域名管理权的权限，子域名应该最多含有两级（以.分割），总长度不能超过253个字符
    - 主域名登记员可以主动移交所有权，但是有效期不重新计算。登记员可以使用交易服务发送域名出售邀约。
    - 主域名登记员可以主动撤销一个其所有主域名的所有权

## 主域名的注册实现
&emsp;&emsp;注册器由2个互相协作的合约组成，分别为存储合约与规则合约，每个顶级域名的注册器的2个合约hash由根域名登记员管理；
- 存储合约
  - 注册器的入口
  - 实现按namehash在私有化存储区查询所有者scripthash（address的一种等价物）
  - 实现允许规则合约允许的注册行为写入私有化存储区
  - 实现允许规则合约允许的注册变更行为写入私有化存储区
  - 实现允许规则合约允许的注销行为写入私有化存储区
  - 实现允许规则合约允许的子域名注册、管理行为写入私有化存储区
  - 存储合约首先从根域名注册器私有化存储区去除当前合法的规则合约hash，并以此作为参数调用规则合约。（NEP4动态合约调用）
- 规则合约
  - 实现域名形式检查方法，返回布尔型
  - 实现域名注册权验证方法，返回布尔型
  - 实现域名变更权验证方法，返回布尔型
  - 实现域名注销权验证方法，返回布尔型
  - 实现子域名注册、管理权的验证方法，返回布尔型
  - 根域名注册器中存储的规则合约hash地址决定注册器使用何种规则，规则应该在重大bug前提下被谨慎变更
 
